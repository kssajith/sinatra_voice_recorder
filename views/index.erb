<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <title>Live input record and playback</title>
    <style>
      
      ul {
          list-style: none;
      }
 
      #playRecord audio {
          display: block;
          margin-bottom: 10px;
      }

    </style>
    <script>
    var createRecording, initAudioRecording, startUserMedia, stopRecording;

$('#start-btn').on('click', function() {
  if (confirm("Once you start recording, you can't pause it.")) {
    return initAudioRecording();
  }
});

$('#stop-btn').on('click', function() {
  return stopRecording(this);
});

stopRecording = function(button) {
  if (window.recorder !== void 0) {
    window.recorder(window.recorder.stop());
    createRecording();
  }
};

createRecording = function() {
  var data;
  recorder && recorder.exportWAV(blob, data = new FormData(), data.append("audio", blob), console.log(data), $.ajax({
    url: 'Your Controller path',
    type: 'POST',
    data: data,
    contentType: false,
    processData: false,
    success: function() {
      return console.log("Successfully uploaded recording.");
    }
  }));
};

startUserMedia = function(stream) {
  var input;
  input = window.audio_context.createMediaStreamSource(stream);
  window.recorder = new Recorder(input, 'audio/mp3');
  window.recorder.record();
};

initAudioRecording = function() {
  var e;
  try {
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    window.URL = window.URL || window.webkitURL;
    window.audio_context = new AudioContext;
    console.log('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
  } catch (_error) {
    e = _error;
    alert('No web audio support in this browser!');
  }
  navigator.getUserMedia({
    audio: true
  }, startUserMedia, function(e) {
    console.log('No live audio input: ' + e);
  });
};

// ---
// generated by coffee-script 1.9.2

    </script>
  </head>
  <body>
    <h1>Recorder.js export example</h1>
    <button id="start-btn">Start recording</button>
    <button disabled="disabled" id="stop-btn">Stop recording</button>
    <h2>Stored Recordings</h2>
    <ul id="playRecord"></ul>
  </body>
</html>
